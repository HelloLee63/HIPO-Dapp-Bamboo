{"ast":null,"code":"import { useState, useRef, useMemo, useEffect, useCallback } from 'react';\n\n// Gets value from localstorage\nfunction getValueFromLocalStorage(key) {\n  var _a;\n  if (typeof localStorage === \"undefined\") {\n    return null;\n  }\n  const storedValue = (_a = localStorage.getItem(key)) !== null && _a !== void 0 ? _a : \"null\";\n  try {\n    return JSON.parse(storedValue);\n  } catch (error) {\n    console.error(error);\n  }\n  return storedValue;\n}\n// Saves value to localstorage\nfunction saveValueToLocalStorage(key, value) {\n  if (typeof localStorage === \"undefined\") {\n    return null;\n  }\n  return localStorage.setItem(key, JSON.stringify(value));\n}\n/**\r\n * @param key Key of the localStorage object\r\n * @param initialState Default initial value\r\n */\nfunction initialize(key, initialState) {\n  const valueLoadedFromLocalStorage = getValueFromLocalStorage(key);\n  if (valueLoadedFromLocalStorage === null) {\n    return typeof initialState === \"function\" ? initialState() : initialState;\n  } else {\n    return valueLoadedFromLocalStorage;\n  }\n}\n/**\r\n * useLocalstorageState hook\r\n * Tracks a value within localStorage and updates it\r\n *\r\n * @param {string} key - Key of the localStorage object\r\n * @param {any} initialState - Default initial value\r\n * @see https://rooks.vercel.app/docs/useLocalstorageState\r\n */\nfunction useLocalstorageState(key, initialState) {\n  const [value, setValue] = useState(() => initialize(key, initialState));\n  const isUpdateFromCrossDocumentListener = useRef(false);\n  const isUpdateFromWithinDocumentListener = useRef(false);\n  const customEventTypeName = useMemo(() => {\n    return `rooks-${key}-localstorage-update`;\n  }, [key]);\n  useEffect(() => {\n    /**\r\n     * We need to ensure there is no loop of\r\n     * storage events fired. Hence we are using a ref\r\n     * to keep track of whether setValue is from another\r\n     * storage event\r\n     */\n    if (!isUpdateFromCrossDocumentListener.current || !isUpdateFromWithinDocumentListener.current) {\n      saveValueToLocalStorage(key, value);\n    }\n  }, [key, value]);\n  const listenToCrossDocumentStorageEvents = useCallback(event => {\n    var _a;\n    if (event.storageArea === localStorage && event.key === key) {\n      try {\n        isUpdateFromCrossDocumentListener.current = true;\n        const newValue = JSON.parse((_a = event.newValue) !== null && _a !== void 0 ? _a : \"null\");\n        if (value !== newValue) {\n          setValue(newValue);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  }, [key, value]);\n  // check for changes across documents\n  useEffect(() => {\n    // eslint-disable-next-line no-negated-condition\n    if (typeof window !== \"undefined\") {\n      window.addEventListener(\"storage\", listenToCrossDocumentStorageEvents);\n      return () => {\n        window.removeEventListener(\"storage\", listenToCrossDocumentStorageEvents);\n      };\n    } else {\n      console.warn(\"useLocalstorageState: window is undefined.\");\n      return () => {};\n    }\n  }, [listenToCrossDocumentStorageEvents]);\n  const listenToCustomEventWithinDocument = useCallback(event => {\n    try {\n      isUpdateFromWithinDocumentListener.current = true;\n      const {\n        newValue\n      } = event.detail;\n      if (value !== newValue) {\n        setValue(newValue);\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }, [value]);\n  // check for changes within document\n  useEffect(() => {\n    // eslint-disable-next-line no-negated-condition\n    if (typeof document !== \"undefined\") {\n      document.addEventListener(customEventTypeName, listenToCustomEventWithinDocument);\n      return () => {\n        document.removeEventListener(customEventTypeName, listenToCustomEventWithinDocument);\n      };\n    } else {\n      console.warn(\"[useLocalstorageState] document is undefined.\");\n      return () => {};\n    }\n  }, [customEventTypeName, listenToCustomEventWithinDocument]);\n  const broadcastValueWithinDocument = useCallback(newValue => {\n    // eslint-disable-next-line no-negated-condition\n    if (typeof document !== \"undefined\") {\n      const event = new CustomEvent(customEventTypeName, {\n        detail: {\n          newValue\n        }\n      });\n      document.dispatchEvent(event);\n    } else {\n      console.warn(\"[useLocalstorageState] document is undefined.\");\n    }\n  }, [customEventTypeName]);\n  const set = useCallback(newValue => {\n    const resolvedNewValue = typeof newValue === \"function\" ? newValue(value) : newValue;\n    isUpdateFromCrossDocumentListener.current = false;\n    isUpdateFromWithinDocumentListener.current = false;\n    setValue(resolvedNewValue);\n    broadcastValueWithinDocument(resolvedNewValue);\n  }, [broadcastValueWithinDocument, value]);\n  const remove = useCallback(() => {\n    localStorage.removeItem(key);\n  }, [key]);\n  return [value, set, remove];\n}\nexport { useLocalstorageState };","map":{"version":3,"names":["useState","useRef","useMemo","useEffect","useCallback","getValueFromLocalStorage","key","_a","localStorage","storedValue","getItem","JSON","parse","error","console","saveValueToLocalStorage","value","setItem","stringify","initialize","initialState","valueLoadedFromLocalStorage","useLocalstorageState","setValue","isUpdateFromCrossDocumentListener","isUpdateFromWithinDocumentListener","customEventTypeName","current","listenToCrossDocumentStorageEvents","event","storageArea","newValue","log","window","addEventListener","removeEventListener","warn","listenToCustomEventWithinDocument","detail","document","broadcastValueWithinDocument","CustomEvent","dispatchEvent","set","resolvedNewValue","remove","removeItem"],"sources":["/Users/lijinxing/Documents/hipo-dapp-bamboo/node_modules/rooks/dist/esm/hooks/useLocalstorageState.js"],"sourcesContent":["import { useState, useRef, useMemo, useEffect, useCallback } from 'react';\n\n// Gets value from localstorage\r\nfunction getValueFromLocalStorage(key) {\r\n    var _a;\r\n    if (typeof localStorage === \"undefined\") {\r\n        return null;\r\n    }\r\n    const storedValue = (_a = localStorage.getItem(key)) !== null && _a !== void 0 ? _a : \"null\";\r\n    try {\r\n        return JSON.parse(storedValue);\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n    }\r\n    return storedValue;\r\n}\r\n// Saves value to localstorage\r\nfunction saveValueToLocalStorage(key, value) {\r\n    if (typeof localStorage === \"undefined\") {\r\n        return null;\r\n    }\r\n    return localStorage.setItem(key, JSON.stringify(value));\r\n}\r\n/**\r\n * @param key Key of the localStorage object\r\n * @param initialState Default initial value\r\n */\r\nfunction initialize(key, initialState) {\r\n    const valueLoadedFromLocalStorage = getValueFromLocalStorage(key);\r\n    if (valueLoadedFromLocalStorage === null) {\r\n        return typeof initialState === \"function\"\r\n            ? initialState()\r\n            : initialState;\r\n    }\r\n    else {\r\n        return valueLoadedFromLocalStorage;\r\n    }\r\n}\r\n/**\r\n * useLocalstorageState hook\r\n * Tracks a value within localStorage and updates it\r\n *\r\n * @param {string} key - Key of the localStorage object\r\n * @param {any} initialState - Default initial value\r\n * @see https://rooks.vercel.app/docs/useLocalstorageState\r\n */\r\nfunction useLocalstorageState(key, initialState) {\r\n    const [value, setValue] = useState(() => initialize(key, initialState));\r\n    const isUpdateFromCrossDocumentListener = useRef(false);\r\n    const isUpdateFromWithinDocumentListener = useRef(false);\r\n    const customEventTypeName = useMemo(() => {\r\n        return `rooks-${key}-localstorage-update`;\r\n    }, [key]);\r\n    useEffect(() => {\r\n        /**\r\n         * We need to ensure there is no loop of\r\n         * storage events fired. Hence we are using a ref\r\n         * to keep track of whether setValue is from another\r\n         * storage event\r\n         */\r\n        if (!isUpdateFromCrossDocumentListener.current ||\r\n            !isUpdateFromWithinDocumentListener.current) {\r\n            saveValueToLocalStorage(key, value);\r\n        }\r\n    }, [key, value]);\r\n    const listenToCrossDocumentStorageEvents = useCallback((event) => {\r\n        var _a;\r\n        if (event.storageArea === localStorage && event.key === key) {\r\n            try {\r\n                isUpdateFromCrossDocumentListener.current = true;\r\n                const newValue = JSON.parse((_a = event.newValue) !== null && _a !== void 0 ? _a : \"null\");\r\n                if (value !== newValue) {\r\n                    setValue(newValue);\r\n                }\r\n            }\r\n            catch (error) {\r\n                console.log(error);\r\n            }\r\n        }\r\n    }, [key, value]);\r\n    // check for changes across documents\r\n    useEffect(() => {\r\n        // eslint-disable-next-line no-negated-condition\r\n        if (typeof window !== \"undefined\") {\r\n            window.addEventListener(\"storage\", listenToCrossDocumentStorageEvents);\r\n            return () => {\r\n                window.removeEventListener(\"storage\", listenToCrossDocumentStorageEvents);\r\n            };\r\n        }\r\n        else {\r\n            console.warn(\"useLocalstorageState: window is undefined.\");\r\n            return () => { };\r\n        }\r\n    }, [listenToCrossDocumentStorageEvents]);\r\n    const listenToCustomEventWithinDocument = useCallback((event) => {\r\n        try {\r\n            isUpdateFromWithinDocumentListener.current = true;\r\n            const { newValue } = event.detail;\r\n            if (value !== newValue) {\r\n                setValue(newValue);\r\n            }\r\n        }\r\n        catch (error) {\r\n            console.log(error);\r\n        }\r\n    }, [value]);\r\n    // check for changes within document\r\n    useEffect(() => {\r\n        // eslint-disable-next-line no-negated-condition\r\n        if (typeof document !== \"undefined\") {\r\n            document.addEventListener(customEventTypeName, listenToCustomEventWithinDocument);\r\n            return () => {\r\n                document.removeEventListener(customEventTypeName, listenToCustomEventWithinDocument);\r\n            };\r\n        }\r\n        else {\r\n            console.warn(\"[useLocalstorageState] document is undefined.\");\r\n            return () => { };\r\n        }\r\n    }, [customEventTypeName, listenToCustomEventWithinDocument]);\r\n    const broadcastValueWithinDocument = useCallback((newValue) => {\r\n        // eslint-disable-next-line no-negated-condition\r\n        if (typeof document !== \"undefined\") {\r\n            const event = new CustomEvent(customEventTypeName, { detail: { newValue } });\r\n            document.dispatchEvent(event);\r\n        }\r\n        else {\r\n            console.warn(\"[useLocalstorageState] document is undefined.\");\r\n        }\r\n    }, [customEventTypeName]);\r\n    const set = useCallback((newValue) => {\r\n        const resolvedNewValue = typeof newValue === \"function\"\r\n            ? newValue(value)\r\n            : newValue;\r\n        isUpdateFromCrossDocumentListener.current = false;\r\n        isUpdateFromWithinDocumentListener.current = false;\r\n        setValue(resolvedNewValue);\r\n        broadcastValueWithinDocument(resolvedNewValue);\r\n    }, [broadcastValueWithinDocument, value]);\r\n    const remove = useCallback(() => {\r\n        localStorage.removeItem(key);\r\n    }, [key]);\r\n    return [value, set, remove];\r\n}\n\nexport { useLocalstorageState };\n"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,MAAM,EAAEC,OAAO,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;;AAEzE;AACA,SAASC,wBAAwBA,CAACC,GAAG,EAAE;EACnC,IAAIC,EAAE;EACN,IAAI,OAAOC,YAAY,KAAK,WAAW,EAAE;IACrC,OAAO,IAAI;EACf;EACA,MAAMC,WAAW,GAAG,CAACF,EAAE,GAAGC,YAAY,CAACE,OAAO,CAACJ,GAAG,CAAC,MAAM,IAAI,IAAIC,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,MAAM;EAC5F,IAAI;IACA,OAAOI,IAAI,CAACC,KAAK,CAACH,WAAW,CAAC;EAClC,CAAC,CACD,OAAOI,KAAK,EAAE;IACVC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;EACxB;EACA,OAAOJ,WAAW;AACtB;AACA;AACA,SAASM,uBAAuBA,CAACT,GAAG,EAAEU,KAAK,EAAE;EACzC,IAAI,OAAOR,YAAY,KAAK,WAAW,EAAE;IACrC,OAAO,IAAI;EACf;EACA,OAAOA,YAAY,CAACS,OAAO,CAACX,GAAG,EAAEK,IAAI,CAACO,SAAS,CAACF,KAAK,CAAC,CAAC;AAC3D;AACA;AACA;AACA;AACA;AACA,SAASG,UAAUA,CAACb,GAAG,EAAEc,YAAY,EAAE;EACnC,MAAMC,2BAA2B,GAAGhB,wBAAwB,CAACC,GAAG,CAAC;EACjE,IAAIe,2BAA2B,KAAK,IAAI,EAAE;IACtC,OAAO,OAAOD,YAAY,KAAK,UAAU,GACnCA,YAAY,EAAE,GACdA,YAAY;EACtB,CAAC,MACI;IACD,OAAOC,2BAA2B;EACtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,oBAAoBA,CAAChB,GAAG,EAAEc,YAAY,EAAE;EAC7C,MAAM,CAACJ,KAAK,EAAEO,QAAQ,CAAC,GAAGvB,QAAQ,CAAC,MAAMmB,UAAU,CAACb,GAAG,EAAEc,YAAY,CAAC,CAAC;EACvE,MAAMI,iCAAiC,GAAGvB,MAAM,CAAC,KAAK,CAAC;EACvD,MAAMwB,kCAAkC,GAAGxB,MAAM,CAAC,KAAK,CAAC;EACxD,MAAMyB,mBAAmB,GAAGxB,OAAO,CAAC,MAAM;IACtC,OAAQ,SAAQI,GAAI,sBAAqB;EAC7C,CAAC,EAAE,CAACA,GAAG,CAAC,CAAC;EACTH,SAAS,CAAC,MAAM;IACZ;AACR;AACA;AACA;AACA;AACA;IACQ,IAAI,CAACqB,iCAAiC,CAACG,OAAO,IAC1C,CAACF,kCAAkC,CAACE,OAAO,EAAE;MAC7CZ,uBAAuB,CAACT,GAAG,EAAEU,KAAK,CAAC;IACvC;EACJ,CAAC,EAAE,CAACV,GAAG,EAAEU,KAAK,CAAC,CAAC;EAChB,MAAMY,kCAAkC,GAAGxB,WAAW,CAAEyB,KAAK,IAAK;IAC9D,IAAItB,EAAE;IACN,IAAIsB,KAAK,CAACC,WAAW,KAAKtB,YAAY,IAAIqB,KAAK,CAACvB,GAAG,KAAKA,GAAG,EAAE;MACzD,IAAI;QACAkB,iCAAiC,CAACG,OAAO,GAAG,IAAI;QAChD,MAAMI,QAAQ,GAAGpB,IAAI,CAACC,KAAK,CAAC,CAACL,EAAE,GAAGsB,KAAK,CAACE,QAAQ,MAAM,IAAI,IAAIxB,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,MAAM,CAAC;QAC1F,IAAIS,KAAK,KAAKe,QAAQ,EAAE;UACpBR,QAAQ,CAACQ,QAAQ,CAAC;QACtB;MACJ,CAAC,CACD,OAAOlB,KAAK,EAAE;QACVC,OAAO,CAACkB,GAAG,CAACnB,KAAK,CAAC;MACtB;IACJ;EACJ,CAAC,EAAE,CAACP,GAAG,EAAEU,KAAK,CAAC,CAAC;EAChB;EACAb,SAAS,CAAC,MAAM;IACZ;IACA,IAAI,OAAO8B,MAAM,KAAK,WAAW,EAAE;MAC/BA,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEN,kCAAkC,CAAC;MACtE,OAAO,MAAM;QACTK,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAEP,kCAAkC,CAAC;MAC7E,CAAC;IACL,CAAC,MACI;MACDd,OAAO,CAACsB,IAAI,CAAC,4CAA4C,CAAC;MAC1D,OAAO,MAAM,CAAE,CAAC;IACpB;EACJ,CAAC,EAAE,CAACR,kCAAkC,CAAC,CAAC;EACxC,MAAMS,iCAAiC,GAAGjC,WAAW,CAAEyB,KAAK,IAAK;IAC7D,IAAI;MACAJ,kCAAkC,CAACE,OAAO,GAAG,IAAI;MACjD,MAAM;QAAEI;MAAS,CAAC,GAAGF,KAAK,CAACS,MAAM;MACjC,IAAItB,KAAK,KAAKe,QAAQ,EAAE;QACpBR,QAAQ,CAACQ,QAAQ,CAAC;MACtB;IACJ,CAAC,CACD,OAAOlB,KAAK,EAAE;MACVC,OAAO,CAACkB,GAAG,CAACnB,KAAK,CAAC;IACtB;EACJ,CAAC,EAAE,CAACG,KAAK,CAAC,CAAC;EACX;EACAb,SAAS,CAAC,MAAM;IACZ;IACA,IAAI,OAAOoC,QAAQ,KAAK,WAAW,EAAE;MACjCA,QAAQ,CAACL,gBAAgB,CAACR,mBAAmB,EAAEW,iCAAiC,CAAC;MACjF,OAAO,MAAM;QACTE,QAAQ,CAACJ,mBAAmB,CAACT,mBAAmB,EAAEW,iCAAiC,CAAC;MACxF,CAAC;IACL,CAAC,MACI;MACDvB,OAAO,CAACsB,IAAI,CAAC,+CAA+C,CAAC;MAC7D,OAAO,MAAM,CAAE,CAAC;IACpB;EACJ,CAAC,EAAE,CAACV,mBAAmB,EAAEW,iCAAiC,CAAC,CAAC;EAC5D,MAAMG,4BAA4B,GAAGpC,WAAW,CAAE2B,QAAQ,IAAK;IAC3D;IACA,IAAI,OAAOQ,QAAQ,KAAK,WAAW,EAAE;MACjC,MAAMV,KAAK,GAAG,IAAIY,WAAW,CAACf,mBAAmB,EAAE;QAAEY,MAAM,EAAE;UAAEP;QAAS;MAAE,CAAC,CAAC;MAC5EQ,QAAQ,CAACG,aAAa,CAACb,KAAK,CAAC;IACjC,CAAC,MACI;MACDf,OAAO,CAACsB,IAAI,CAAC,+CAA+C,CAAC;IACjE;EACJ,CAAC,EAAE,CAACV,mBAAmB,CAAC,CAAC;EACzB,MAAMiB,GAAG,GAAGvC,WAAW,CAAE2B,QAAQ,IAAK;IAClC,MAAMa,gBAAgB,GAAG,OAAOb,QAAQ,KAAK,UAAU,GACjDA,QAAQ,CAACf,KAAK,CAAC,GACfe,QAAQ;IACdP,iCAAiC,CAACG,OAAO,GAAG,KAAK;IACjDF,kCAAkC,CAACE,OAAO,GAAG,KAAK;IAClDJ,QAAQ,CAACqB,gBAAgB,CAAC;IAC1BJ,4BAA4B,CAACI,gBAAgB,CAAC;EAClD,CAAC,EAAE,CAACJ,4BAA4B,EAAExB,KAAK,CAAC,CAAC;EACzC,MAAM6B,MAAM,GAAGzC,WAAW,CAAC,MAAM;IAC7BI,YAAY,CAACsC,UAAU,CAACxC,GAAG,CAAC;EAChC,CAAC,EAAE,CAACA,GAAG,CAAC,CAAC;EACT,OAAO,CAACU,KAAK,EAAE2B,GAAG,EAAEE,MAAM,CAAC;AAC/B;AAEA,SAASvB,oBAAoB"},"metadata":{},"sourceType":"module"}