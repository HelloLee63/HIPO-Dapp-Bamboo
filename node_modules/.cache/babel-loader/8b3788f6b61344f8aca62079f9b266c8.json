{"ast":null,"code":"var _jsxFileName = \"/Users/lijinxing/Documents/hipo-dapp-bamboo/src/web3/ContractManagerProvider.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$(),\n  _s5 = $RefreshSig$();\nimport { createContext, useContext, useRef } from \"react\";\nimport { useReload } from \"../hooks/useReload\";\nimport { useWallet } from \"../wallet/walletProvider\";\nimport ContractListener from \"./components/contract-listener/ContractListener\";\nimport Web3Contract from \"./web3Contract\";\nimport { useWeb3 } from \"./web3Provider\";\nimport FinancingCenterContract from \"./contracts/FinancingCenterContract\";\nimport Erc20Contract from \"./contracts/erc20Contract\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Context = /*#__PURE__*/createContext();\nexport function useContractManager() {\n  _s();\n  return useContext(Context);\n}\n_s(useContractManager, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function useContract(address, factory) {\n  _s2();\n  const [reload] = useReload();\n  const manager = useContractManager();\n  const contract = manager.getContract(address, factory);\n  contract.on(Web3Contract.UPDATE_DATA, reload);\n  return contract;\n}\n_s2(useContract, \"QdGfl9TjEviy8SpltTNLXXiNn7k=\", false, function () {\n  return [useReload, useContractManager];\n});\nexport function useErc20Contract(address) {\n  _s3();\n  let abi = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  const [reload] = useReload();\n  const manager = useContractManager();\n  if (!address) {\n    return undefined;\n  }\n  const contract = manager.getContract(address, () => new Erc20Contract(abi, address));\n  contract.on(Web3Contract.UPDATE_DATA, reload);\n  return contract;\n}\n_s3(useErc20Contract, \"QdGfl9TjEviy8SpltTNLXXiNn7k=\", false, function () {\n  return [useReload, useContractManager];\n});\nexport function useFinancingCenterContract(address) {\n  _s4();\n  let abi = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  const [reload] = useReload();\n  const manager = useContractManager();\n  if (!address) {\n    return undefined;\n  }\n  const contract = manager.getContract(address, () => new FinancingCenterContract(abi, address));\n  contract.on(Web3Contract.UPDATE_DATA, reload);\n  return contract;\n}\n_s4(useFinancingCenterContract, \"QdGfl9TjEviy8SpltTNLXXiNn7k=\", false, function () {\n  return [useReload, useContractManager];\n});\nconst ContractManagerProvider = props => {\n  _s5();\n  const {\n    children\n  } = props;\n  const wallet = useWallet();\n  const web3 = useWeb3();\n  const contractsRef = useRef(new Map());\n  const [reload] = useReload();\n  const web3ProviderRef = useRef(web3.activeProvider);\n  if (web3ProviderRef.current !== web3.activeProvider) {\n    web3ProviderRef.current = web3.activeProvider;\n    contractsRef.current.forEach(contract => {\n      contract.setCallProvider(web3.activeProvider);\n    });\n    reload();\n  }\n  const walletProviderRef = useRef(wallet.provider);\n  if (walletProviderRef.current !== wallet.provider) {\n    walletProviderRef.current = wallet.provider;\n    contractsRef.current.forEach(contract => {\n      contract.setProvider(wallet.provider);\n    });\n    reload();\n  }\n  const walletAccountRef = useRef(wallet.account);\n  if (walletAccountRef.current !== wallet.account) {\n    walletAccountRef.current = wallet.account;\n    contractsRef.current.forEach(contract => {\n      contract.setAccount(wallet.account);\n    });\n    reload();\n  }\n  function getContract(address, factory) {\n    let contract;\n    if (!contractsRef.current.has(address)) {\n      var _factory;\n      contract = (_factory = factory === null || factory === void 0 ? void 0 : factory()) !== null && _factory !== void 0 ? _factory : new Web3Contract([], address, '');\n      contract.setCallProvider(web3ProviderRef.current);\n      contract.setProvider(walletProviderRef.current);\n      contract.setAccount(walletAccountRef.current);\n      contractsRef.current.set(address, contract);\n      reload();\n    } else {\n      contract = contractsRef.current.get(address);\n    }\n    return contract;\n  }\n  const value = {\n    getContract\n  };\n  return /*#__PURE__*/_jsxDEV(Context.Provider, {\n    value: value,\n    children: [children, Array.from(contractsRef.current).map(_ref => {\n      let [address, contract] = _ref;\n      return /*#__PURE__*/_jsxDEV(ContractListener, {\n        contract: contract\n      }, address, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this);\n    })]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 124,\n    columnNumber: 5\n  }, this);\n};\n_s5(ContractManagerProvider, \"K8yI8Z2c2ePY5VrRsaNJSq54fpM=\", false, function () {\n  return [useWallet, useWeb3, useReload];\n});\n_c = ContractManagerProvider;\nexport default ContractManagerProvider;\nvar _c;\n$RefreshReg$(_c, \"ContractManagerProvider\");","map":{"version":3,"names":["createContext","useContext","useRef","useReload","useWallet","ContractListener","Web3Contract","useWeb3","FinancingCenterContract","Erc20Contract","jsxDEV","_jsxDEV","Context","useContractManager","_s","useContract","address","factory","_s2","reload","manager","contract","getContract","on","UPDATE_DATA","useErc20Contract","_s3","abi","arguments","length","undefined","useFinancingCenterContract","_s4","ContractManagerProvider","props","_s5","children","wallet","web3","contractsRef","Map","web3ProviderRef","activeProvider","current","forEach","setCallProvider","walletProviderRef","provider","setProvider","walletAccountRef","account","setAccount","has","_factory","set","get","value","Provider","Array","from","map","_ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/lijinxing/Documents/hipo-dapp-bamboo/src/web3/ContractManagerProvider.jsx"],"sourcesContent":["import { createContext, useContext, useRef } from \"react\";\nimport { useReload } from \"../hooks/useReload\";\nimport { useWallet } from \"../wallet/walletProvider\";\nimport ContractListener from \"./components/contract-listener/ContractListener\";\nimport Web3Contract from \"./web3Contract\";\nimport { useWeb3 } from \"./web3Provider\";\nimport FinancingCenterContract from \"./contracts/FinancingCenterContract\";\nimport Erc20Contract from \"./contracts/erc20Contract\";\n\nconst Context = createContext()\n\nexport function useContractManager() {\n  return useContext(Context)\n}\n\nexport function useContract(address, factory) {\n  const [reload] = useReload()\n  const manager = useContractManager()\n\n  const contract = manager.getContract(address, factory)\n\n  contract.on(Web3Contract.UPDATE_DATA, reload)\n  return contract\n}\n\nexport function useErc20Contract(address, abi = []) {\n  const [reload] = useReload()\n  const manager = useContractManager()\n\n  if (!address) {\n    return undefined\n  }\n\n  const contract = manager.getContract(address, () => new Erc20Contract(abi, address))\n  \n  contract.on(Web3Contract.UPDATE_DATA, reload)\n\n  return contract\n}\n\nexport function useFinancingCenterContract(address, abi = []) {\n  const [reload] = useReload()\n  const manager = useContractManager()\n\n  if (!address) {\n    return undefined\n  }\n\n  const contract = manager.getContract(address, () => new FinancingCenterContract(abi, address))\n  \n  contract.on(Web3Contract.UPDATE_DATA, reload)\n\n  return contract\n}\n\nconst ContractManagerProvider = props => {\n\n  const { children } = props\n\n  const wallet = useWallet()\n  const web3 = useWeb3()\n  const contractsRef = useRef(new Map())\n  const [reload] = useReload()\n\n  const web3ProviderRef = useRef(web3.activeProvider)\n\n  if (web3ProviderRef.current !== web3.activeProvider) {\n    web3ProviderRef.current = web3.activeProvider\n\n    contractsRef.current.forEach(contract => {\n      contract.setCallProvider(web3.activeProvider)\n    })\n\n    reload()\n  }\n\n  const walletProviderRef = useRef(wallet.provider)\n\n  if(walletProviderRef.current !== wallet.provider) {\n    walletProviderRef.current = wallet.provider\n\n    contractsRef.current.forEach(contract => {\n      contract.setProvider(wallet.provider)\n    })\n\n    reload()\n  }\n\n  const walletAccountRef = useRef(wallet.account)\n\n  if (walletAccountRef.current !== wallet.account) {\n    walletAccountRef.current = wallet.account\n\n    contractsRef.current.forEach(contract => {\n      contract.setAccount(wallet.account)\n    })\n\n    reload()\n  }\n\n  function getContract(address, factory) {\n    let contract\n\n    if (!contractsRef.current.has(address)) {\n      contract = factory?.() ?? new Web3Contract([], address, '')\n      contract.setCallProvider(web3ProviderRef.current)\n      contract.setProvider(walletProviderRef.current)            \n      contract.setAccount(walletAccountRef.current)\n\n      contractsRef.current.set(address, contract)\n      reload()\n    } else {\n      contract = contractsRef.current.get(address)\n    }\n\n    return contract\n  }\n\n  const value = {\n    getContract,\n  }\n\n  return (\n    <Context.Provider value={value}>\n      {children}\n      {Array.from(contractsRef.current).map(([address, contract]) => (\n        <ContractListener key={address} contract={contract} />\n      ))}\n    </Context.Provider>\n  )\n}\n\nexport default ContractManagerProvider"],"mappings":";;;;;;AAAA,SAASA,aAAa,EAAEC,UAAU,EAAEC,MAAM,QAAQ,OAAO;AACzD,SAASC,SAAS,QAAQ,oBAAoB;AAC9C,SAASC,SAAS,QAAQ,0BAA0B;AACpD,OAAOC,gBAAgB,MAAM,iDAAiD;AAC9E,OAAOC,YAAY,MAAM,gBAAgB;AACzC,SAASC,OAAO,QAAQ,gBAAgB;AACxC,OAAOC,uBAAuB,MAAM,qCAAqC;AACzE,OAAOC,aAAa,MAAM,2BAA2B;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEtD,MAAMC,OAAO,gBAAGZ,aAAa,EAAE;AAE/B,OAAO,SAASa,kBAAkBA,CAAA,EAAG;EAAAC,EAAA;EACnC,OAAOb,UAAU,CAACW,OAAO,CAAC;AAC5B;AAACE,EAAA,CAFeD,kBAAkB;AAIlC,OAAO,SAASE,WAAWA,CAACC,OAAO,EAAEC,OAAO,EAAE;EAAAC,GAAA;EAC5C,MAAM,CAACC,MAAM,CAAC,GAAGhB,SAAS,EAAE;EAC5B,MAAMiB,OAAO,GAAGP,kBAAkB,EAAE;EAEpC,MAAMQ,QAAQ,GAAGD,OAAO,CAACE,WAAW,CAACN,OAAO,EAAEC,OAAO,CAAC;EAEtDI,QAAQ,CAACE,EAAE,CAACjB,YAAY,CAACkB,WAAW,EAAEL,MAAM,CAAC;EAC7C,OAAOE,QAAQ;AACjB;AAACH,GAAA,CAReH,WAAW;EAAA,QACRZ,SAAS,EACVU,kBAAkB;AAAA;AAQpC,OAAO,SAASY,gBAAgBA,CAACT,OAAO,EAAY;EAAAU,GAAA;EAAA,IAAVC,GAAG,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EAChD,MAAM,CAACT,MAAM,CAAC,GAAGhB,SAAS,EAAE;EAC5B,MAAMiB,OAAO,GAAGP,kBAAkB,EAAE;EAEpC,IAAI,CAACG,OAAO,EAAE;IACZ,OAAOc,SAAS;EAClB;EAEA,MAAMT,QAAQ,GAAGD,OAAO,CAACE,WAAW,CAACN,OAAO,EAAE,MAAM,IAAIP,aAAa,CAACkB,GAAG,EAAEX,OAAO,CAAC,CAAC;EAEpFK,QAAQ,CAACE,EAAE,CAACjB,YAAY,CAACkB,WAAW,EAAEL,MAAM,CAAC;EAE7C,OAAOE,QAAQ;AACjB;AAACK,GAAA,CAbeD,gBAAgB;EAAA,QACbtB,SAAS,EACVU,kBAAkB;AAAA;AAapC,OAAO,SAASkB,0BAA0BA,CAACf,OAAO,EAAY;EAAAgB,GAAA;EAAA,IAAVL,GAAG,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EAC1D,MAAM,CAACT,MAAM,CAAC,GAAGhB,SAAS,EAAE;EAC5B,MAAMiB,OAAO,GAAGP,kBAAkB,EAAE;EAEpC,IAAI,CAACG,OAAO,EAAE;IACZ,OAAOc,SAAS;EAClB;EAEA,MAAMT,QAAQ,GAAGD,OAAO,CAACE,WAAW,CAACN,OAAO,EAAE,MAAM,IAAIR,uBAAuB,CAACmB,GAAG,EAAEX,OAAO,CAAC,CAAC;EAE9FK,QAAQ,CAACE,EAAE,CAACjB,YAAY,CAACkB,WAAW,EAAEL,MAAM,CAAC;EAE7C,OAAOE,QAAQ;AACjB;AAACW,GAAA,CAbeD,0BAA0B;EAAA,QACvB5B,SAAS,EACVU,kBAAkB;AAAA;AAapC,MAAMoB,uBAAuB,GAAGC,KAAK,IAAI;EAAAC,GAAA;EAEvC,MAAM;IAAEC;EAAS,CAAC,GAAGF,KAAK;EAE1B,MAAMG,MAAM,GAAGjC,SAAS,EAAE;EAC1B,MAAMkC,IAAI,GAAG/B,OAAO,EAAE;EACtB,MAAMgC,YAAY,GAAGrC,MAAM,CAAC,IAAIsC,GAAG,EAAE,CAAC;EACtC,MAAM,CAACrB,MAAM,CAAC,GAAGhB,SAAS,EAAE;EAE5B,MAAMsC,eAAe,GAAGvC,MAAM,CAACoC,IAAI,CAACI,cAAc,CAAC;EAEnD,IAAID,eAAe,CAACE,OAAO,KAAKL,IAAI,CAACI,cAAc,EAAE;IACnDD,eAAe,CAACE,OAAO,GAAGL,IAAI,CAACI,cAAc;IAE7CH,YAAY,CAACI,OAAO,CAACC,OAAO,CAACvB,QAAQ,IAAI;MACvCA,QAAQ,CAACwB,eAAe,CAACP,IAAI,CAACI,cAAc,CAAC;IAC/C,CAAC,CAAC;IAEFvB,MAAM,EAAE;EACV;EAEA,MAAM2B,iBAAiB,GAAG5C,MAAM,CAACmC,MAAM,CAACU,QAAQ,CAAC;EAEjD,IAAGD,iBAAiB,CAACH,OAAO,KAAKN,MAAM,CAACU,QAAQ,EAAE;IAChDD,iBAAiB,CAACH,OAAO,GAAGN,MAAM,CAACU,QAAQ;IAE3CR,YAAY,CAACI,OAAO,CAACC,OAAO,CAACvB,QAAQ,IAAI;MACvCA,QAAQ,CAAC2B,WAAW,CAACX,MAAM,CAACU,QAAQ,CAAC;IACvC,CAAC,CAAC;IAEF5B,MAAM,EAAE;EACV;EAEA,MAAM8B,gBAAgB,GAAG/C,MAAM,CAACmC,MAAM,CAACa,OAAO,CAAC;EAE/C,IAAID,gBAAgB,CAACN,OAAO,KAAKN,MAAM,CAACa,OAAO,EAAE;IAC/CD,gBAAgB,CAACN,OAAO,GAAGN,MAAM,CAACa,OAAO;IAEzCX,YAAY,CAACI,OAAO,CAACC,OAAO,CAACvB,QAAQ,IAAI;MACvCA,QAAQ,CAAC8B,UAAU,CAACd,MAAM,CAACa,OAAO,CAAC;IACrC,CAAC,CAAC;IAEF/B,MAAM,EAAE;EACV;EAEA,SAASG,WAAWA,CAACN,OAAO,EAAEC,OAAO,EAAE;IACrC,IAAII,QAAQ;IAEZ,IAAI,CAACkB,YAAY,CAACI,OAAO,CAACS,GAAG,CAACpC,OAAO,CAAC,EAAE;MAAA,IAAAqC,QAAA;MACtChC,QAAQ,IAAAgC,QAAA,GAAGpC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,EAAI,cAAAoC,QAAA,cAAAA,QAAA,GAAI,IAAI/C,YAAY,CAAC,EAAE,EAAEU,OAAO,EAAE,EAAE,CAAC;MAC3DK,QAAQ,CAACwB,eAAe,CAACJ,eAAe,CAACE,OAAO,CAAC;MACjDtB,QAAQ,CAAC2B,WAAW,CAACF,iBAAiB,CAACH,OAAO,CAAC;MAC/CtB,QAAQ,CAAC8B,UAAU,CAACF,gBAAgB,CAACN,OAAO,CAAC;MAE7CJ,YAAY,CAACI,OAAO,CAACW,GAAG,CAACtC,OAAO,EAAEK,QAAQ,CAAC;MAC3CF,MAAM,EAAE;IACV,CAAC,MAAM;MACLE,QAAQ,GAAGkB,YAAY,CAACI,OAAO,CAACY,GAAG,CAACvC,OAAO,CAAC;IAC9C;IAEA,OAAOK,QAAQ;EACjB;EAEA,MAAMmC,KAAK,GAAG;IACZlC;EACF,CAAC;EAED,oBACEX,OAAA,CAACC,OAAO,CAAC6C,QAAQ;IAACD,KAAK,EAAEA,KAAM;IAAApB,QAAA,GAC5BA,QAAQ,EACRsB,KAAK,CAACC,IAAI,CAACpB,YAAY,CAACI,OAAO,CAAC,CAACiB,GAAG,CAACC,IAAA;MAAA,IAAC,CAAC7C,OAAO,EAAEK,QAAQ,CAAC,GAAAwC,IAAA;MAAA,oBACxDlD,OAAA,CAACN,gBAAgB;QAAegB,QAAQ,EAAEA;MAAS,GAA5BL,OAAO;QAAA8C,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,QAAwB;IAAA,CACvD,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,QACe;AAEvB,CAAC;AAAA9B,GAAA,CA3EKF,uBAAuB;EAAA,QAIZ7B,SAAS,EACXG,OAAO,EAEHJ,SAAS;AAAA;AAAA+D,EAAA,GAPtBjC,uBAAuB;AA6E7B,eAAeA,uBAAuB;AAAA,IAAAiC,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module"}